import * as PIXI from "pixi.js";
import { App } from "../system/App";

export class World {
  private worldContainer: PIXI.Container;
  private tileSize: number = 16;
  private mapData: { background: number[][], world: number[][] };

  constructor() {
    this.mapData = {
      background: [
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      ],
      world: [
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
      ],
    };

    this.worldContainer = this.createWorld();
  }

  private createWorld() {
    const container = new PIXI.Container();

    for (let row = 0; row < this.mapData.world.length; row++) {
      for (let col = 0; col < this.mapData.world[row].length; col++) {
        const tileValue = this.mapData.world[row][col];
        const texture = this.getTileTexture(tileValue);

        const tile = new PIXI.Sprite(texture);
        tile.width = this.tileSize;
        tile.height = this.tileSize;
        tile.x = col * this.tileSize;
        tile.y = row * this.tileSize;

        container.addChild(tile);
      }
    }

    return container;
  }

  private getTileTexture(tileValue: number) {
    switch (tileValue) {
      case 0:
        return PIXI.Texture.from('assets/tiles/empty.png');
      case 1:
        return PIXI.Texture.from('assets/tiles/wall.png');
      default:
        return PIXI.Texture.EMPTY;
    }
  }

  public getWorldContainer() {
    return this.worldContainer;
  }
}

